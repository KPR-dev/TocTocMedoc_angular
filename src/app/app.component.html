<div class="navbar">
    <button (click)="previousPage()"><i class="fa-solid fa-chevron-left"></i></button>
    <p>Page {{currentPageIndex+1}} / {{pageCount}}</p>
    <button (click)="nextPage()"><i class="fa-solid fa-chevron-right"></i></button>
</div>



<div class="wrapper">
    <main>
        <header>
            <h1>TocTocMedoc</h1>
            <h2>By E-Pharma GA</h2>
            <p>Cette solution vous permet d'avoir la disponibilité des produits et faire des réservations dans toutes les pharmacies possédant le logiciel ePharma</p>

            <p>
                <a href="https://epharma.ga">En savoir plus</a>

            </p>
        </header>

        <div class="produit-container">
            <p class="search-title">Recherchez des produits sur la page actuelle, utilisez les flèches pour changer de page
            </p>
            <!-- popup inetrface -->
            <!-- <div id="popup1" class="overlay" *ngIf="showSnackbar">
                <div class="popup">
                    <h2>Here i am</h2>
                    <div class="content">
                        Thank to pop me out of that button, but now i'm done so you can close this window.
                    </div>
                </div>
            </div> -->

            <!-- fin popup -->
            <div class="form-group-search">
                <input type="search" name="search" id="search" (keyup)="applyFilter($event)" placeholder="Trouver un produit...">
            </div>

            <div class="loader-container" *ngIf="filteredProduit.length == 0 && hasResult == false">
                <div class="loader"></div>
            </div>

            <div class="no-result" *ngIf="filteredProduit.length == 0 && hasResult == true">

                <p><i class="fa-solid fa-magnifying-glass"></i> Aucun résultat sur cette page, veuillez vérifier sur les autres pages !</p>
            </div>

            <div class="produits">
                <div class="produit" *ngFor="let produit of filteredProduit">
                    <div class="img-container">
                        <img [src]="produit.photoURL" *ngIf="produit.photoURL" alt="">
                        <img src="../assets/placeholder.png" *ngIf="!produit.photoURL" alt="">
                    </div>
                    <div class="row-between">
                        <h4>{{produit.libelle}}</h4>
                        <!-- <p class="gray">{{produit.prix_vente}} FCFA</p> -->
                        <p class="gray">{{produit.code_table ? 'Sous ordonnance' : ''}}</p>
                        <div class="row">
                            <button *ngIf="isLoggedIn" (click)="verify(produit.CIP)">Vérifier</button>
                        </div>
                        <div class="row">
                            <button *ngIf="!isLoggedIn" (click)="verify(produit.CIP)" disabled class="btn btn-secondary">Vérifier</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>




<button class="close-modal" *ngIf="selectedProduit || loginFormVisible || modal_register" (click)="clear()">&times;</button>
<div class="inscription" *ngIf="modal_register">
    <div id="popup1" class="overlay" *ngIf="showSnackbar1">
        <div class="popup">
            <h4 style="color: green;">Inscription success !!!</h4>
        </div>
    </div>

    <div id="popup1" class="overlay" *ngIf="showSnackbarError1">
        <div class="popup">
            <h4 style="color: red;">Erreur lors de l'enregistrement</h4>
        </div>
    </div>

    <div class="loader-container" *ngIf="loader">
        <div class="loader"></div>
    </div>

    <div class="verify-container" *ngIf="formInscription" style="max-width: 70%;">
        <!-- loader -->

        <div class="verify-content" *ngIf="formInscription">

            <!-- Formulaire d'inscription -->
            <div class="verify-commande">
                <h3 *ngIf="form1">Veuillez remplir le formulaire d'inscription!</h3>
                <form [formGroup]="registerForm" (ngSubmit)="submitRegistrationForm()">
                    <div class="d-flex" *ngIf="form1">
                        <div class="mx-2 px-4" style="margin-top: 15%;">
                            <div class="row">
                                <div class="col-6 mb-4">

                                    <input type="text" id="nom" formControlName="lastname" [(ngModel)]="users.lastname" class="form-control" placeholder="Entrez votre nom">
                                    <div style="color: red;" *ngIf="lastname.errors?.['required'] && lastname.touched">
                                        Veuillez renseigner votre nom!
                                    </div>
                                </div>

                                <div class="col-6 mb-4">

                                    <input type="text" id="prenom" formControlName="firstname" [(ngModel)]="users.firstname" class="form-control" placeholder="Entrez votre prénom">
                                    <div style="color: red;" *ngIf="firstname.errors?.['required'] && firstname.touched">
                                        Veuillez renseigner votre prénom!
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-6 mb-4">

                                    <input type="email" id="email" formControlName="email" [(ngModel)]="users.email" class="form-control" placeholder="Votre adresse email">
                                    <div style="color: red;" *ngIf="email.errors?.['email'] && (email.dirty || email.touched)">
                                        Email non valide
                                    </div>
                                </div>

                                <div class="col-6 mb-4">

                                    <input type="text" id="phone" formControlName="phone" [(ngModel)]="users.phone" class="form-control" placeholder="Votre numéro de téléphone">
                                    <div style="color: red;" *ngIf="phone.errors?.['required'] && phone.touched">
                                        Veuillez renseigner votre numéro de téléphone!
                                    </div>
                                </div>
                            </div>

                            <div>
                                <div class="form-group mb-3">

                                    <input type="password" id="password" formControlName="password" [(ngModel)]="users.password" class="form-control" placeholder="Mot de passe">
                                    <div style="color: red;" *ngIf="password.errors?.['required'] && password.touched">
                                        Veuillez renseigner votre mot de passe!
                                    </div>
                                </div>

                                <div class="form-group mb-3">

                                    <input type="password" id="confirm_password" formControlName="confirm_password" class="form-control" placeholder="Confirmer le mot de passe">
                                    <div style="color: red;" *ngIf="confirm_password.errors?.['required'] && confirm_password.touched">
                                        Veuillez renseigner votre mot de passe!
                                    </div>
                                </div>
                            </div>

                            <button id="reset" (click)="forminvisible()">S'inscrire</button>
                        </div>

                        <div>
                            <img src="../assets/_483668e6-f804-4744-91d6-a4b1b632322d.png" alt="" width="300px" height="500px" class="rounded">
                        </div>
                    </div>
                    <div class="verify-container" style="margin-left: 20%;" *ngIf="contrat">
                        <div class="verify-content">
                            <!-- Formulaire d'inscription -->
                            <div class="verify-commande">
                                <p>
                                    L'utilisation du service fourni par TocTocMedoc est soumise aux conditions suivantes. En acceptant ces termes, l'utilisateur s'engage à ne pas violer les lois applicables et à respecter les droits des autres utilisateurs du service. L'utilisateur est
                                    seul responsable de toutes les activités associées à son compte. TocTocMedoc se réserve le droit de suspendre ou de résilier le compte d'un utilisateur en cas de violation flagrante de ces conditions. Les informations
                                    fournies par l'utilisateur lors de l'inscription doivent être exactes et complètes. TocTocMedoc peut mettre à jour les termes du contrat d'utilisation à tout moment, et l'utilisateur sera informé de ces modifications.
                                    L'utilisation continue du service après de telles modifications constitue l'acceptation des nouveaux termes.
                                </p>
                            </div>
                            <!-- <button id="username">Annuler</button> <button id="username" class="btn btn-primary">Accepter</button> -->
                        </div>
                        <button type="button" id="reset" class="btn btn-secondary">Annuler</button> <button type="submit" id="reset">Accepter</button>
                    </div>
                </form>

            </div>


        </div>
    </div>
</div>
<div class="inscription" *ngIf="loginFormVisible">
    <div id="popup1" class="overlay" *ngIf="showSnackbar">
        <div class="popup">
            <h4 style="color: green;">Connexion success !!!</h4>
        </div>
    </div>
    <div id="popup1" class="overlay" *ngIf="showSnackbarError">
        <div class="popup">
            <h4 style="color: red;">Mauvais identifiant !!!</h4>
        </div>
    </div>
    <!-- Formulaire de connexion -->
    <div class="verify-container" *ngIf="formConnexion === false" style="max-width: 60%">
        <div class="verify-content" style="display: flex; margin: 0px">
            <div class="verify-commande">

                <p>Connectez-vous et commencez à chercher des médicaments</p><br><br>
                <form (ngSubmit)="submitLoginForm()">
                    <!-- ... Champs de connexion ... -->
                    <div class="form-group">

                        <input type="email" [(ngModel)]="users.username" id="email" name="username" required placeholder="Entrez votre adresse mail">
                    </div>
                    <div class="form-group">

                        <input type="password" [(ngModel)]="users.password" id="password" name="password" required placeholder="Mot de passe">
                    </div>
                    <a href="#" (click)="open_reset_password()" style="font-size: 10px">Mot de passe oublié ?</a>
                    <button type="submit">Se connecter</button>
                </form>
            </div>

            <div style="margin-left: 20px;">
                <img src="../assets/_48438b55-a0f0-4a9a-afee-88d44dad7f1c.png" alt="" width="300px" height="300px" style="border-radius: 5px;">
            </div>
        </div>
    </div>
</div>

<!-- mot de passe oublié, formulaire  -->
<div class="inscription" *ngIf="ResetPassword">
    <div class="verify-container" style="max-width: 45%">
        <button (click)="clearModification()" id="change">X</button>
        <div class="verify-content" style="display: flex;">
            <!-- Formulaire de connexion -->
            <div class="verify-commande">
                <p>Veuillez remplir le formulaire</p><br><br>
                <form>
                    <!-- ... Champs de connexion ... -->
                    <div class="form-group">

                        <input type="email" id="email" name="username" required placeholder="Entrez votre mail">
                    </div>
                    <button type="submit">Rénitialiser</button>
                </form>
            </div>

            <div>
                <img src="../assets/image.png" alt="" width="300px" height="300px" style="border-radius: 5px;">
            </div>
        </div>
    </div>
</div>

<!-- formulaire d'infomation user  -->

<button class="close-modal" *ngIf="modal_tarif" (click)="clear()">&times;</button>
<div class="inscription" *ngIf="modal_tarif">
    <div class="verify-container">
        <div class="verify-content">
            <!-- Formulaire d'inscription -->
            <div class="verify-commande">
                <p>Choisir un tarif</p>

                <div class="tarif">
                    <div class="produit" *ngFor="let produit of listTarif" (click)="clickTarif(produit.id)">
                        <div class="card">
                            <!-- Vous pouvez ajouter ici une image du produit -->
                            <h6> Titre : {{produit.libelle}}</h6>
                            <h6>Prix : {{produit.price}}</h6>
                            <h6>Nombre de crédit : {{produit.credit}}</h6>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- fin -->


<!-- modal des modification user -->

<button class="close-modal" *ngIf="modal_modification" (click)="clear()">&times;</button>
<div class="inscription d-flex" *ngIf="modal_modification" style="background: white; padding-right: 400px">

    <div class="verify-container" *ngIf="formModification">
        <div class="verify-content">
            <!-- Formulaire -->
            <div class="verify-commande" style="float: left; height: 500px; margin-right: 100px">
                <h4>Profil</h4>
                <form [formGroup]="registerForm" (ngSubmit)="updateForm()">
                    <div class="form-group">
                        <label for="nom">Nom :</label>
                        <h6 id="nom">{{users.lastname}}</h6>
                    </div>

                    <div class="form-group">
                        <label for="prenom">Prénom :</label>
                        <h6 id="prenom">{{users.firstname}}</h6>
                    </div>

                    <div class="form-group">
                        <label for="email">Email :</label>
                        <h6 id="email">{{users.email}}</h6>

                    </div>
                    <div class="form-group">
                        <label for="phone">Téléphone :</label>
                        <h6 id="phone">{{users.phone}}</h6>
                    </div>

                </form><br>
                <a href="#" class="btn btn-secondary" (click)="profil()">Modifier le profil</a><br>
                <a href="#" class="btn btn-primary mt-2" (click)="open_mdp()">Changer de mot de passe</a>
            </div>
        </div>
    </div>
    <div class="verify-container" style="margin-bottom: 45%; width: 200px; ">
        <div class="verify-content">
            <!-- Formulaire -->
            <div class="verify-commande">
                <h4>Crédits</h4><br>
                <p>{{ users.credit}}</p>
            </div>
        </div>
    </div>
</div>

<div class="inscription" *ngIf="modal_modification1">

    <div id="popup1" class="overlay" *ngIf="showSnackbar2">
        <div class="popup">
            <h4 style="color: green;">Mise à jour success !!!</h4>
        </div>
    </div>
    <div id="popup1" class="overlay" *ngIf="showSnackbarError2">
        <div class="popup">
            <h4 style="color: red;">Erreur lors de la modification</h4>
        </div>
    </div>
    <div class="verify-container" *ngIf="formModification1">
        <button (click)="clearModification()" id="change">X</button>
        <div class="verify-content">
            <!-- Formulaire -->
            <div class="verify-commande">
                <p>Information utilisateur</p>
                <form [formGroup]="registerForm" (ngSubmit)="updateForm()">
                    <div class="form-group">
                        <label for="nom">Nom *:</label>
                        <input type="text" id="nom" formControlName="lastname" [(ngModel)]="users.lastname">
                    </div>

                    <div class="form-group">
                        <label for="prenom">Prénom *:</label>
                        <input type="text" id="prenom" formControlName="firstname" [(ngModel)]="users.firstname">
                    </div>

                    <div class="form-group">
                        <label for="email">Email *:</label>
                        <input type="email" id="email" formControlName="email" [(ngModel)]="users.email">
                        <div style="color: red;" *ngIf="email.errors?.['email'] && (email.dirty || email.touched)">
                            Email non valide
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="phone">Téléphone *:</label>
                        <input type="text" id="phone" formControlName="phone" [(ngModel)]="users.phone">
                        <div style="color: red;" *ngIf="phone.errors?.['required']&& phone.touched">
                            Veuillez renseigner votre numero télephone!
                        </div>
                    </div>
                    <!-- ... Vos champs d'inscription existants ... -->
                    <button type="submit">Mise à jour</button>
                </form><br>

            </div>
        </div>
    </div>
</div>


<!-- mot de passe change -->

<div class="inscription" *ngIf="changeMdp">

    <div id="popup1" class="overlay" *ngIf="showSnackbar3">
        <div class="popup">
            <h4 style="color: green;">Mise à jour success !!!</h4>
        </div>
    </div>
    <div id="popup1" class="overlay" *ngIf="showSnackbarError3">
        <div class="popup">
            <h4 style="color: red;">Erreur lors de la modification</h4>
        </div>
    </div>
    <div class="verify-container">
        <button (click)="clearModification()" id="change">X</button>
        <div class="verify-content">
            <!-- Formulaire -->
            <div class="verify-commande">
                <p>Information utilisateur</p>
                <form [formGroup]="registerForm" (ngSubmit)="updatePassword()">
                    <div class="form-group">
                        <input type="password" [(ngModel)]="users.ancien_password" id="ancien_password" name="ancien_password" placeholder="Entrez le mot de passe actuel">
                    </div>
                    <div class="form-group">
                        <input type="password" [(ngModel)]="users.password" id="password" name="password" required placeholder="Nouveau mot de passe">
                    </div>
                    <div class="form-group">
                        <input type="password" [(ngModel)]="users.confirm_password" id="confirm_password" name="confirm_password" required placeholder="Confirmez le mot de passe">
                    </div>
                    <button type="submit">Changer</button>
                </form><br>

            </div>
        </div>
    </div>
</div>

<!-- fin grille tarifaires -->
<button *ngIf="loggedInUser" id="username" (click)="open_modal_modification()">
    <p style="font-size: 25px;">N°00241{{ loggedInUser.id }}</p>
</button>
<!-- fin Bouton inscription -->

<button class="logout" *ngIf="loggedInUser" (click)="deconnexion()"> <i class="fa fa-sign-out" aria-hidden="true" ></i> Déconnexion</button>

<button class="close-modal" *ngIf="selectedProduit || showCart" (click)="clear()">&times;</button>

<div class="logout" *ngIf="!loggedInUser">
    <button *ngIf="!loggedInUser" (click)="open_inscription()" class="connexion"> Connexion</button> <button *ngIf="!loggedInUser" class="inscriptions" (click)="open_register()"> Inscription</button>
</div>
<button class="shopping-cart-btn" (click)="openCartView()"><span class="count"
    *ngIf="carts.length > 0">{{carts.length}}</span>
  <img src="../assets/add-to-cart.png" alt="Panier">
</button>





<div class="modal" *ngIf="selectedProduit">
    <div class="verify-container">
        <div class="verify-content">
            <div class="verify-produit">
                <div class="img-container">
                    <img [src]="selectedProduit.photoURL" *ngIf="selectedProduit.photoURL" alt="Image produit">
                    <img src="../assets/placeholder.png" *ngIf="!selectedProduit.photoURL" alt="">
                </div>
                <div>
                    <h3>{{selectedProduit.libelle}}</h3>
                </div>
                <button (click)="clear()">Rechercher d'autres produits</button>
            </div>
            <div class="verify-result" *ngIf="!selectedPharmacy">
                <h3>
                    <div class="loader-container" *ngIf="verifiedPharmacies.length == 0">
                        <div class="loader"></div>
                    </div>
                    <span>
            Recherche de la disponibilité en pharmacie...
          </span>
                </h3>

                <div class="pharmacies">
                    <div class="pharmacy" *ngFor="let pharmacy of verifiedPharmacies">
                        <div>
                            <p class="name">{{pharmacy.nom}}</p>
                            <p>{{pharmacy.adresse}}, Tel: {{pharmacy.telephone}}</p>
                        </div>
                        <!--
<button (click)="select(pharmacy)">Ajouter au panier</button>
            -->
                    </div>
                </div>
            </div>

            <div class="verify-commande" *ngIf="selectedPharmacy">
                <h3>
                    Confirmation de la reservation
                </h3>
                <h4>{{selectedPharmacy.nom}}</h4>
                <h5>{{selectedPharmacy.adresse}}, Tel: {{selectedPharmacy.telephone}}</h5>

                <div class="loader-container" *ngIf="commandeResult.start == true && commandeResult.success == null">
                    <div class="loader"></div>
                </div>

                <div class="form-container" *ngIf="commandeResult.start == false && commandeResult.success == null">
                    <!--
          <div class="form-group">
            <label for="nom">Nom</label>
            <input type="text" [(ngModel)]="buyer" name="nom">
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" [(ngModel)]="buyerEmail" name="email">
          </div>
          <div class="form-group">
            <label for="telephone">Téléphone</label>
            <input type="text" [(ngModel)]="buyerPhone" name="telephone">
          </div>
        -->
                    <div class="form-group">
                        <label for="quantite">Quantité</label>
                        <input type="number" [(ngModel)]="quantity" name="quantite">
                    </div>
                    <button *ngIf="quantity > 0" (click)="addToCart(selectedProduit.CIP, selectedProduit.libelle)">Valider</button>

                </div>

                <div *ngIf="commandeResult.start == false && commandeResult.success != null">
                    <div class="result-message">{{commandeResult.message}}</div>

                    <p *ngIf="commandeResult.success"><strong>Veuillez bien conserver le numéro de réservation pour la
              récuperation</strong></p>
                </div>

            </div>

        </div>
    </div>
</div>

<div class="modal shopping-modal" *ngIf="showCart">
    <div class="verify-container">
        <div class="verify-content">
            <div *ngIf="commandeResult.start == false && commandeResult.success != null">
                <div class="result-message">{{commandeResult.message}}</div>

                <p *ngIf="commandeResult.success"><strong>Veuillez bien conserver le numéro de réservation pour la
            récuperation. Les réservations expirent après 24h.</strong></p>
            </div>
            <div class="cart" *ngFor="let cart of carts; let i = index">
                <h3><img src="../assets/add-to-cart.png" alt=""> {{cart.pharmacyName}}</h3>
                <div class="products-cart">
                    <div class="product" *ngFor="let produit of cart.products">
                        <span>{{produit.produitName}}</span>
                        <span>{{produit.quantity}}</span>
                        <button (click)="removeFromCart(produit.produitCIP, i)">Retirer</button>
                    </div>
                </div>
                <div class="loader-container" *ngIf="commandeResult.start == true && commandeResult.success == null">
                    <div class="loader"></div>
                </div>
                <button (click)="commander(cart, i)" *ngIf="!(commandeResult.start == true && commandeResult.success == null)">Commander</button>
            </div>
        </div>
    </div>
</div>