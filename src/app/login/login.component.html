<div class="navbar">
    <button (click)="previousPage()"><i class="fa-solid fa-chevron-left"></i></button>
    <p>Page {{currentPageIndex+1}} / {{pageCount}}</p>
    <button (click)="nextPage()"><i class="fa-solid fa-chevron-right"></i></button>
</div>



<div class="wrapper">
    <main>
        <header>
            <h1>TocTocMedoc</h1>
            <h2>By E-Pharma GA</h2>
            <p>Cette solution vous permet d'avoir la disponibilité des produits et faire des réservations dans toutes les pharmacies possédant le logiciel ePharma</p>

            <p>
                <a href="https://epharma.ga">En savoir plus</a>

            </p>
        </header>

        <div class="produit-container">
            <p class="search-title">Recherchez des produits sur la page actuelle, utilisez les flèches pour changer de page
            </p>

            <div class="form-group-search">
                <input type="search" name="search" id="search" (keyup)="applyFilter($event)" placeholder="Trouver un produit...">
            </div>

            <div class="loader-container" *ngIf="filteredProduit.length == 0 && hasResult == false">
                <div class="loader"></div>
            </div>

            <div class="no-result" *ngIf="filteredProduit.length == 0 && hasResult == true">

                <p><i class="fa-solid fa-magnifying-glass"></i> Aucun résultat sur cette page, veuillez vérifier sur les autres pages !</p>
            </div>

            <div class="produits">
                <div class="produit" *ngFor="let produit of filteredProduit">
                    <div class="img-container">
                        <img [src]="produit.photoURL" *ngIf="produit.photoURL" alt="">
                        <img src="../assets/placeholder.png" *ngIf="!produit.photoURL" alt="">
                    </div>
                    <div class="row-between">
                        <h4>{{produit.libelle}}</h4>
                        <!-- <p class="gray">{{produit.prix_vente}} FCFA</p> -->
                        <p class="gray">{{produit.code_table ? 'Sous ordonnance' : ''}}</p>
                        <div class="row">
                            <button (click)="clickVerify('Vérifier', produit.CIP)" value="Vérifier">Vérifier</button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </main>
</div>


<div class="inscription" *ngIf="modal_verifier">
    <div id="popup1" class="overlay" *ngIf="showSnackbarError4">
        <div class="popup">
            <h4 style="color: red;">{{smserror}}</h4>
        </div>
    </div>
    <div class="verify-container" *ngIf="form_modal_verifier">
        <div class="verify-content">
            <!-- Formulaire d'inscription -->
            <div class="verify-commande">
                <p>Voulez-vous continuer ?</p>
                <div>
                    <p>Disponible à {{addressProduit}}</p>
                </div>
                <div class="tarif">
                    <p>Cette action vaut {{creditUser}} crédit(s)</p>
                </div>
            </div>
            <button class="btn btn-secondary" (click)="clear()">Annuler</button><button (click)="validerCredit(creditUser)" class="btn btn-primary mx-2">Confirmer</button>
        </div>
    </div>
</div>

<div class="inscription" *ngIf="modal_tarif">
    <div class="verify-container">
        <button id="change" (click)="clear()">Fermer</button>
        <div class="verify-content">
            <!-- Formulaire d'inscription -->
            <div class="verify-commande">
                <p>Choisir un tarif</p>

                <div class="tarif">
                    <div class="produit" *ngFor="let produit of listTarif" (click)="clickTarif(produit.id, produit.price)">
                        <div class="card">
                            <!-- Vous pouvez ajouter ici une image du produit -->
                            <h6> Titre : {{produit.libelle}}</h6>
                            <h6>Prix : {{produit.price}}</h6>
                            <h6>Nombre de crédit : {{produit.credit}}</h6>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- fin -->


<!-- modal des modification user -->

<div class="inscription d-flex justify-content-center align-items-center" *ngIf="modal_modification" style="background: white;">
    <div class="verify-container container">
        <div class="row">
            <!-- Formulaire -->
            <div class="verify-commande col-md-8">
                <h4>Profil</h4>
                <form [formGroup]="registerForm" (ngSubmit)="updateForm()">
                    <div class="form-group">
                        <label for="nom">Nom :</label>
                        <h6 id="nom">{{users.lastname}}</h6>
                    </div>
                    <div class="form-group">
                        <label for="prenom">Prénom :</label>
                        <h6 id="prenom">{{users.firstname}}</h6>
                    </div>
                    <div class="form-group">
                        <label for="email">Email :</label>
                        <h6 id="email">{{users.email}}</h6>
                    </div>
                    <div class="form-group">
                        <label for="phone">Téléphone :</label>
                        <h6 id="phone">{{users.phone}}</h6>
                    </div>
                    <a class="btn btn-secondary" (click)="profil()">Modifier le profil</a><br>
                    <a class="btn btn-primary mt-2" (click)="open_mdp()">Changer de mot de passe</a>
                    <button (click)="clear()" id="change">Quitter</button>
                </form>
            </div>
            <!-- Informations sur les crédits -->
            <div class="verify-commande col-md-4">
                <h4>Crédits</h4>
                <p>{{ users.credit}}</p>
                <button class="btn btn-primary mt-2" (click)="open_info_user_tarif()">Souscrire à un tarif</button>
            </div>
        </div>
    </div>
</div>



<div class="inscription" *ngIf="modal_modification1">

    <div id="popup1" class="overlay" *ngIf="showSnackbar2">
        <div class="popup">
            <h4 style="color: green;">Mise à jour success !!!</h4>
        </div>
    </div>
    <div id="popup1" class="overlay" *ngIf="showSnackbarError2">
        <div class="popup">
            <h4 style="color: red;">{{smserror}}</h4>
        </div>
    </div>
    <div class="verify-container" *ngIf="formModification1">

        <div class="verify-content">
            <!-- Formulaire -->
            <div class="verify-commande">
                <p>Information utilisateur</p>
                <form [formGroup]="registerForm" (ngSubmit)="updateForm()">
                    <div class="form-group">
                        <label for="nom">Nom *:</label>
                        <input type="text" id="nom" formControlName="lastname" [(ngModel)]="users.lastname">
                    </div>

                    <div class="form-group">
                        <label for="prenom">Prénom *:</label>
                        <input type="text" id="prenom" formControlName="firstname" [(ngModel)]="users.firstname">
                    </div>

                    <div class="form-group">
                        <label for="email">Email *:</label>
                        <input type="email" id="email" formControlName="email" [(ngModel)]="users.email">
                        <div style="color: red;" *ngIf="email.errors?.['email'] && (email.dirty || email.touched)">
                            Email non valide
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="phone">Téléphone *:</label>
                        <input type="text" id="phone" formControlName="phone" [(ngModel)]="users.phone">
                        <div style="color: red;" *ngIf="phone.errors?.['required']&& phone.touched">
                            Veuillez renseigner votre numero télephone!
                        </div>
                    </div>
                    <!-- ... Vos champs d'inscription existants ... -->
                    <button type="submit">Mise à jour</button>
                    <button (click)="clearModification()" id="change">Fermer</button>
                </form><br>

            </div>
        </div>
    </div>
</div>

<!-- tarif à l'espace info users -->
<div class="inscription" *ngIf="modal_info_tarif_user">
    <div class="verify-container">

        <div class="verify-content">
            <!-- Formulaire d'inscription -->
            <div class="verify-commande">
                <p>Choisir un tarif</p>

                <div class="tarif">
                    <div class="produit" *ngFor="let produit of listTarif" (click)="clickTarifInfoUser(produit.id, produit.price)">
                        <div class="card">
                            <!-- Vous pouvez ajouter ici une image du produit -->
                            <h6> Titre : {{produit.libelle}}</h6>
                            <h6>Prix : {{produit.price}}</h6>
                            <h6>Nombre de crédit : {{produit.credit}}</h6>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button id="change" (click)="clearModification()">Fermer</button>
    </div>
</div>

<!-- fin -->


<!-- mot de passe change -->

<div class="inscription" *ngIf="changeMdp">

    <div id="popup1" class="overlay" *ngIf="showSnackbar3">
        <div class="popup">
            <h4 style="color: green;">Mise à jour success !!!</h4>
        </div>
    </div>
    <div id="popup1" class="overlay" *ngIf="showSnackbarError3">
        <div class="popup">
            <h4 style="color: red;">{{smserror}}</h4>
        </div>
    </div>
    <div class="verify-container" *ngIf="showMdpForm">

        <div class="verify-content">
            <!-- Formulaire -->
            <div class="verify-commande">
                <p>Information utilisateur</p>
                <form [formGroup]="registerForm" (ngSubmit)="updatePassword()">
                    <div class="form-group">
                        <input type="password" id="password" formControlName="password" class="form-control" placeholder="Nouveau mot de passe">
                    </div>
                    <div class="form-group">
                        <input type="password" formControlName="confirm_password" id="confirm_password" required placeholder="Confirmez le mot de passe">
                    </div>
                    <button type="submit">Changer</button>
                    <button (click)="clearModification()" id="change">Fermer</button>
                </form><br>

            </div>
        </div>
    </div>
</div>

<!-- fin grille tarifaires -->
<div class="boutton d-flex">
    <div style="margin-right: 100%;">
        <button class="inscriptions" (click)="open_modal_modification()">
      N°00241{{ loggedInUser }}
  </button>
    </div>
    <!-- fin Bouton inscription -->

    <div>
        <button class="connexion bg-black text-white" (click)="logout()"> <i class="fa fa-sign-out " aria-hidden="true" ></i> Déconnexion</button>

    </div>
</div>
<button class="close-modal" *ngIf="selectedProduit || showCart" (click)="clear()" style="font-size: 10px;">Fermer</button>


<button class="shopping-cart-btn" (click)="openCartView()"><span class="count"
*ngIf="carts.length > 0">{{carts.length}}</span>
<img src="../assets/add-to-cart.png" alt="Panier">
</button>





<div class="modal" *ngIf="selectedProduit">
    <div id="popup1" class="overlay" *ngIf="showSnackbar4">
        <div class="popup">
            <h4 style="color: green;">Crédit débiter !!!</h4>
        </div>
    </div>
    <div class="verify-container">
        <div class="verify-content">
            <div class="verify-produit">
                <div class="img-container">
                    <img [src]="selectedProduit.photoURL" *ngIf="selectedProduit.photoURL" alt="Image produit">
                    <img src="../assets/placeholder.png" *ngIf="!selectedProduit.photoURL" alt="">
                </div>
                <div>
                    <h3>{{selectedProduit.libelle}}</h3>
                </div>
                <button (click)="clear()">Rechercher d'autres produits</button>
            </div>
            <div class="verify-result" *ngIf="!selectedPharmacy">
                <h3>
                    <div class="loader-container" *ngIf="verifiedPharmacies.length == 0">
                        <div class="loader"></div>
                    </div>
                    <span>
        Recherche de la disponibilité en pharmacie...
      </span>
                </h3>

                <div class="pharmacies">
                    <div class="pharmacy" *ngFor="let pharmacy of verifiedPharmacies">
                        <div>
                            <p class="name">{{pharmacy.nom}}</p>
                            <p>{{pharmacy.adresse}}, Tel: {{pharmacy.telephone}}</p>
                        </div>
                        <!--
<button (click)="select(pharmacy)">Ajouter au panier</button>
        -->
                    </div>
                </div>
            </div>

            <div class="verify-commande" *ngIf="selectedPharmacy">
                <h3>
                    Confirmation de la reservation
                </h3>
                <h4>{{selectedPharmacy.nom}}</h4>
                <h5>{{selectedPharmacy.adresse}}, Tel: {{selectedPharmacy.telephone}}</h5>

                <div class="loader-container" *ngIf="commandeResult.start == true && commandeResult.success == null">
                    <div class="loader"></div>
                </div>

                <div class="form-container" *ngIf="commandeResult.start == false && commandeResult.success == null">
                    <!--
      <div class="form-group">
        <label for="nom">Nom</label>
        <input type="text" [(ngModel)]="buyer" name="nom">
      </div>
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" [(ngModel)]="buyerEmail" name="email">
      </div>
      <div class="form-group">
        <label for="telephone">Téléphone</label>
        <input type="text" [(ngModel)]="buyerPhone" name="telephone">
      </div>
    -->
                    <div class="form-group">
                        <label for="quantite">Quantité</label>
                        <input type="number" [(ngModel)]="quantity" name="quantite">
                    </div>
                    <button *ngIf="quantity > 0" (click)="addToCart(selectedProduit.CIP, selectedProduit.libelle)">Valider</button>

                </div>

                <div *ngIf="commandeResult.start == false && commandeResult.success != null">
                    <div class="result-message">{{commandeResult.message}}</div>

                    <p *ngIf="commandeResult.success"><strong>Veuillez bien conserver le numéro de réservation pour la
          récuperation</strong></p>
                </div>

            </div>

        </div>
    </div>
</div>

<div class="modal shopping-modal" *ngIf="showCart">
    <div class="verify-container">
        <div class="verify-content">
            <div *ngIf="commandeResult.start == false && commandeResult.success != null">
                <div class="result-message">{{commandeResult.message}}</div>

                <p *ngIf="commandeResult.success"><strong>Veuillez bien conserver le numéro de réservation pour la
        récuperation. Les réservations expirent après 24h.</strong></p>
            </div>
            <div class="cart" *ngFor="let cart of carts; let i = index">
                <h3><img src="../assets/add-to-cart.png" alt=""> {{cart.pharmacyName}}</h3>
                <div class="products-cart">
                    <div class="product" *ngFor="let produit of cart.products">
                        <span>{{produit.produitName}}</span>
                        <span>{{produit.quantity}}</span>
                        <button (click)="removeFromCart(produit.produitCIP, i)">Retirer</button>
                    </div>
                </div>
                <div class="loader-container" *ngIf="commandeResult.start == true && commandeResult.success == null">
                    <div class="loader"></div>
                </div>
                <button (click)="commander(cart, i)" *ngIf="!(commandeResult.start == true && commandeResult.success == null)">Commander</button>
            </div>
        </div>
    </div>
</div>
